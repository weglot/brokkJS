/*! BrokkJS 2019-02-20 */

!function(r,t,n,e){var a="brokkJS";function i(i,t){this.element=i,this._name=a,this._defaults=r.fn.brokk.defaults;var o={},s=["toUpdateElements","triggerElements","toFireSuccessElements"];r.each(this._defaults,function(t,e){if("function"!=typeof e){var n=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();e=r(i).data("brokk-"+n),-1!==s.indexOf(t)&&"string"==typeof e&&(e=e.split(",").map(function(t){return"this"===t.trim()?i:t})),"requestParams"===t&&void 0!==e&&(e=JSON.parse(e)),o[t]=e}}),void 0!==o.params&&(o.params=JSON.parse(o.params)),this.options=r.extend({},this._defaults,o),this.options=r.extend({},this.options,t),this.init()}r.extend(i.prototype,{init:function(){this.buildCache(),this.bindEvents()},destroy:function(){this.unbindEvents(),this.$element.removeData()},buildCache:function(){this.$element=r(this.element)},bindEvents:function(){var e=this;switch(this.options.fireEvent){case r.fn.brokk.fireEvents.ON_READY:r(n).ready(function(){e.fire()});break;case r.fn.brokk.fireEvents.ON_CLICK:e.$element.on("click."+e._name,function(){e.fire()});break;case r.fn.brokk.fireEvents.ON_SUBMIT:e.$element.on("submit."+e._name,function(t){r(this)[0].checkValidity()&&(t.preventDefault(),e.fire())})}},unbindEvents:function(){this.$element.off("."+this._name)},callback:function(t,e){"function"==typeof t&&t.call(this,e)},fire:function(){var e=this;this.callback(this.options.before),r.ajax({url:this.options.requestUrl,type:this.options.requestMethod,dataType:"json",data:this.options.requestParams,success:function(t){e.callback(e.options.onSuccess,{data:t})},error:function(t){e.callback(e.options.onError,{xhr:t})}}).always(function(){e.callback(e.options.onComplete)})},fireSuccessElements:function(t){this.options.toFireSuccessElements.forEach(function(t){r(t).data("plugin_"+a)&&r(t).brokkApi().fire()})},before:function(t){this.options.triggerElements.forEach(function(t){r(t).prop("disabled",!0),r(t).addClass("disabled")}),this.options.showOverlay&&this.options.toUpdateElements.forEach(function(t){0===r(t).find("#brokk-loading").length&&r(t).append('<span id="brokk-loading">'+r.fn.brokk.loadingTemplate+"</span>")})},onSuccess:function(e){this.options.toUpdateElements.forEach(function(t){r(t).html(e.data)}),this.fireSuccessElements()},onError:function(t){},onComplete:function(t){this.options.triggerElements.forEach(function(t){r(t).prop("disabled",!1),r(t).removeClass("disabled")}),this.options.toUpdateElements.forEach(function(t){r(t).find("#brokk-loading").remove()})}}),r.fn.brokk=function(t){return this.each(function(){r.data(this,"plugin_"+a)||r.data(this,"plugin_"+a,new i(this,t))})},r.fn.brokkApi=function(){return r.data(this[0],"plugin_"+a)},r.fn.brokk.loadingTemplate="Loading",r.fn.brokk.fireEvents={ON_READY:"onReady",ON_CLICK:"onClick",ON_SUBMIT:"onSubmit"},r.fn.brokk.defaults={requestUrl:null,requestMethod:"GET",requestParams:null,fireEvent:r.fn.brokk.fireEvents.ON_READY,toUpdateElements:[],triggerElements:[],toFireSuccessElements:[],showOverlay:!0,before:function(t){this.before(t)},onSuccess:function(t){this.onSuccess(t)},onError:function(t){this.onError(t)},onComplete:function(t){this.onComplete(t)}}}(jQuery,window,document);